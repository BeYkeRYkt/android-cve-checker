From 0b3f432326b87a859fd1ee8ce312845cd3dfa4fe Mon Sep 17 00:00:00 2001
From: Javi Merino <javi.merino@arm.com>
Date: Thu, 8 Mar 2018 18:01:42 +0000
Subject: [PATCH] input: touch: ftm4: Fix length of memset() to avoid using
 uninitialized memory

When building the kernel with gcc 7.2, the compiler detects a
misleading memset() construct:

drivers/input/touchscreen/stm/ftm4_pdc.c: In function 'store_cmd':
drivers/input/touchscreen/stm/ftm4_pdc.c:470:2: error: 'memset' used with length equal to number of elements without mu
ltiplication by element size [-Werror=memset-elt-size]
  memset(info->cmd_param, 0x00, ARRAY_SIZE(info->cmd_param));
  ^~~~~~

info->cmd_param is a an array of ints.  ARRAY_SIZE gives you the
number of ints in the array (CMD_PARAM_NUM in this case).  However,
memset is expecting the number of bytes to zero, which is 4x the
number of ints in the array.

Use sizeof() to zero out the whole array and potentially avoid using
uninitialized memory.

Bug: 78364203
Change-Id: I24207ca94bf34ad26d90b4929d6bbbf9edf3c49e
Signed-off-by: Javi Merino <javi.merino@arm.com>
Signed-off-by: Steve Pfetsch <spfetsch@google.com>
---
 drivers/input/touchscreen/stm/ftm4_pdc.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/input/touchscreen/stm/ftm4_pdc.c b/drivers/input/touchscreen/stm/ftm4_pdc.c
index 66a1d91262475..31592387cb7a5 100644
--- a/drivers/input/touchscreen/stm/ftm4_pdc.c
+++ b/drivers/input/touchscreen/stm/ftm4_pdc.c
@@ -473,7 +473,7 @@ static ssize_t store_cmd(struct device *dev, struct device_attribute *devattr,
 	info->cmd_is_running = true;
 	mutex_unlock(&info->cmd_lock);
 	info->cmd_state = 1;
-	memset(info->cmd_param, 0x00, ARRAY_SIZE(info->cmd_param));
+	memset(info->cmd_param, 0x00, sizeof(info->cmd_param));
 
 	len = (int)count;
 	if (*(buf + len - 1) == '\n')
