From f37e859ab4c55c6c56e3c157bbed3024fc8d0dc6 Mon Sep 17 00:00:00 2001
From: Nick Desaulniers <ndesaulniers@google.com>
Date: Thu, 4 May 2017 13:25:44 -0700
Subject: [PATCH] Revert "proc: smaps: Allow smaps access for CAP_SYS_RESOURCE"

This reverts commit f0ce0eee6b71bc310153edb87e66e6b25e12fece.

Bug: 34951864
Bug: 36468447
Change-Id: I87bd92e096c6c28a53b9ecf302ae008f5e58eba1
Signed-off-by: Nick Desaulniers <ndesaulniers@google.com>
---
 kernel/fork.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/kernel/fork.c b/kernel/fork.c
index 2b11e384fef83..b6eecda85690e 100644
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@ -725,8 +725,7 @@ struct mm_struct *mm_access(struct task_struct *task, unsigned int mode)
 
 	mm = get_task_mm(task);
 	if (mm && mm != current->mm &&
-			!ptrace_may_access(task, mode) &&
-			!capable(CAP_SYS_RESOURCE)) {
+			!ptrace_may_access(task, mode)) {
 		mmput(mm);
 		mm = ERR_PTR(-EACCES);
 	}
