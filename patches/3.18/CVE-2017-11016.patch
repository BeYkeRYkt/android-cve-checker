From 6bb0d13bbd9df966a9a2b801e5204937285413fe Mon Sep 17 00:00:00 2001
From: Siena Richard <sienar@codeaurora.org>
Date: Wed, 26 Apr 2017 11:18:15 -0700
Subject: ASoC: msm: qdsp6v2: clear address on error

Set address to NULL on error to ensure a stale address is not used.

CRs-Fixed: 2038685
Signed-off-by: Siena Richard <sienar@codeaurora.org>
Change-Id: I17e7b7b404625d21721b2466e70fa8be2370b517
---
 sound/soc/msm/qdsp6v2/audio_cal_utils.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/sound/soc/msm/qdsp6v2/audio_cal_utils.c b/sound/soc/msm/qdsp6v2/audio_cal_utils.c
index c33284d..c023d51 100644
--- a/sound/soc/msm/qdsp6v2/audio_cal_utils.c
+++ b/sound/soc/msm/qdsp6v2/audio_cal_utils.c
@@ -640,7 +640,9 @@ done:
 	return cal_block;
 err:
 	kfree(cal_block->cal_info);
+	cal_block->cal_info = NULL;
 	kfree(cal_block->client_info);
+	cal_block->client_info = NULL;
 	kfree(cal_block);
 	cal_block = NULL;
 	return cal_block;
-- 
cgit v1.1

