From bfd8ffc65e6e82de2adceba58bd67137fb3b2024 Mon Sep 17 00:00:00 2001
From: Shubhraprakash Das <sadas@codeaurora.org>
Date: Wed, 7 Dec 2016 15:25:27 -0800
Subject: msm: camera: isp: Check userspace parameters

Check the user parameters passed to prevent buffer overflow.

Change-Id: Ia8adc88d993db9e4314f3aa85ff5bbb6d7cef31e
CRs-Fixed: 1097390
Signed-off-by: Shubhraprakash Das <sadas@codeaurora.org>
Signed-off-by: Meera Gande <mgande@codeaurora.org>
---
 drivers/media/platform/msm/camera_v2/ispif/msm_ispif.c | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/drivers/media/platform/msm/camera_v2/ispif/msm_ispif.c b/drivers/media/platform/msm/camera_v2/ispif/msm_ispif.c
index 4a1ea20..649a363 100644
--- a/drivers/media/platform/msm/camera_v2/ispif/msm_ispif.c
+++ b/drivers/media/platform/msm/camera_v2/ispif/msm_ispif.c
@@ -132,7 +132,7 @@ static void msm_ispif_get_pack_mask_from_cfg(
 			pack_mask[0] |= temp;
 		CDBG("%s:num %d cid %d mode %d pack_mask %x %x\n",
 			__func__, entry->num_cids, entry->cids[i],
-			pack_cfg[i].pack_mode,
+			pack_cfg[entry->cids[i]].pack_mode,
 			pack_mask[0], pack_mask[1]);
 
 	}
@@ -165,6 +165,16 @@ static int msm_ispif_config2(struct ispif_device *ispif,
 	}
 
 	for (i = 0; i < params->num; i++) {
+		int j;
+
+		if (params->entries[i].num_cids > MAX_CID_CH_v2)
+			return -EINVAL;
+		for (j = 0; j < params->entries[i].num_cids; j++)
+			if (params->entries[i].cids[j] >= CID_MAX)
+				return -EINVAL;
+	}
+
+	for (i = 0; i < params->num; i++) {
 		intftype = params->entries[i].intftype;
 		vfe_intf = params->entries[i].vfe_intf;
 
-- 
cgit v1.1

