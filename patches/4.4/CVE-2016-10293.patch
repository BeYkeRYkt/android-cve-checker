From be1708643216b2ac2d8d123b4a6a838132320274 Mon Sep 17 00:00:00 2001
From: Steve Pfetsch <spfetsch@google.com>
Date: Mon, 13 Mar 2017 12:54:19 -0700
Subject: [PATCH] msm: mdss: prevent info leak in panel_debug_base_reg_write

Check for correct sscanf return value while parsing buffer to prevent
uninitialized data from potentially leaking in later debug print.

Bug: 33352393
Change-Id: I747746742cbc48631bc2cb53f60b00a4ac7dab91
Signed-off-by: Steve Pfetsch <spfetsch@google.com>
---
 drivers/video/msm/mdss/mdss_debug.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/video/msm/mdss/mdss_debug.c b/drivers/video/msm/mdss/mdss_debug.c
index feb73bcf089e3..759ed14339f19 100644
--- a/drivers/video/msm/mdss/mdss_debug.c
+++ b/drivers/video/msm/mdss/mdss_debug.c
@@ -170,6 +170,8 @@ static ssize_t panel_debug_base_reg_write(struct file *file,
 		p[2] = 0;
 		pr_debug("p[%d] = %pK:%s\n", i, p, p);
 		cnt = sscanf(p, "%x", &tmp);
+		if (cnt != 1)
+			return -EFAULT;
 		reg[i] = tmp;
 		pr_debug("reg[%d] = %x\n", i, (int)reg[i]);
 	}
