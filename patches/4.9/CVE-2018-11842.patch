From 2c68e8610d374555614f3ff7a4b81ee4ea58a754 Mon Sep 17 00:00:00 2001
From: gaurank kathpalia <gkathpal@codeaurora.org>
Date: Mon, 23 Apr 2018 08:07:46 +0530
Subject: [PATCH] qcacld-3.0: Remove cds_pkt_free in assoc request api

In the API lim_send_assoc_req_mgmt_frame, the host
allocates memory for the assoc request packet
taking all inputs of payload and the mac header
size etc, and in case the mem allocation fails
it clears away the memory allocated to the packet
with cds packet free, which was not even allocated

Fix is to remove the packet free in case of memory not
allocated

Bug: 111124974
Change-Id: I3fb75b1947dfe039605c42aa19c2d0bacc7bf55d
CRs-Fixed: 2216741
Signed-off-by: Kumar Anand <kumaranand@google.com>
---
 .../qcacld-3.0/core/mac/src/pe/lim/lim_send_management_frames.c | 2 --
 1 file changed, 2 deletions(-)

diff --git a/drivers/staging/qcacld-3.0/core/mac/src/pe/lim/lim_send_management_frames.c b/drivers/staging/qcacld-3.0/core/mac/src/pe/lim/lim_send_management_frames.c
index 1508d68094228..cb05cca17cfa7 100644
--- a/drivers/staging/qcacld-3.0/core/mac/src/pe/lim/lim_send_management_frames.c
+++ b/drivers/staging/qcacld-3.0/core/mac/src/pe/lim/lim_send_management_frames.c
@@ -1966,8 +1966,6 @@ lim_send_assoc_req_mgmt_frame(tpAniSirGlobal mac_ctx,
 
 		assoc_cnf.resultCode = eSIR_SME_RESOURCES_UNAVAILABLE;
 
-		cds_packet_free((void *)packet);
-
 		lim_post_sme_message(mac_ctx, LIM_MLM_ASSOC_CNF,
 			(uint32_t *) &assoc_cnf);
 
